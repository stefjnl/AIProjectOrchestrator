# US-011A: Core Prompt Generation Functionality

## User Story
**As a** developer using the AI Project Orchestrator  
**I want** to generate coding prompts for individual user stories from my approved story collection  
**So that** I can create targeted, high-quality prompts for AI assistants to implement specific features

## Context
After completing the first 3 workflow stages (Requirements Analysis, Project Planning, User Stories), users need the ability to generate comprehensive coding prompts for individual stories. The backend prompt generation service is complete - this story implements the frontend interface for accessing that functionality.

## Acceptance Criteria

### Story Display & Selection
- [ ] **Story Card Interface**: Display approved user stories as individual cards showing story title, user type, want statement, and so-that statement
- [ ] **Grid Layout**: Present story cards in a responsive grid (minimum 400px width per card)
- [ ] **Status Indicators**: Show prompt generation status for each story (Not Started, Pending Review, Approved, Rejected)
- [ ] **Individual Generation**: Each story card has a "Generate Prompt" button for independent prompt creation

### API Integration
- [ ] **Extended APIClient**: Add 4 new methods to `window.APIClient`:
  - `generatePrompt(storyGenerationId, storyIndex, preferences)`
  - `getPromptStatus(promptId)`
  - `canGeneratePrompt(storyGenerationId, storyIndex)`
  - `getPrompt(promptId)`
- [ ] **Prerequisite Validation**: Verify stories are approved before allowing prompt generation
- [ ] **Error Handling**: Display meaningful error messages for validation failures and service errors

### State Management
- [ ] **WorkflowManager Extension**: Add story-level tracking to existing `WorkflowManager` class:
  - Track prompt ID per story index
  - Track approval status per story
  - Persist state in localStorage with project-specific keys
- [ ] **Status Synchronization**: Poll for prompt approval status changes and update UI automatically
- [ ] **Cross-Session Persistence**: Maintain prompt generation state across browser sessions

### Workflow Integration
- [ ] **Stage 4 Section**: Add prompt generation section to existing `workflow.html` after Stage 3
- [ ] **Progressive Disclosure**: Show story cards only when stories are approved
- [ ] **Button State Management**: Update generation buttons based on prompt status:
  - "Generate Prompt" (not started)
  - "Generating..." (pending review, disabled)
  - "View Prompt" (approved, clickable)
- [ ] **Review Queue Integration**: Generated prompts appear in existing review queue for approval

### Basic Prompt Viewing
- [ ] **Prompt Display**: Basic interface to view generated prompt content when approved
- [ ] **Copy Functionality**: Allow users to copy prompt text to clipboard
- [ ] **Navigation Flow**: Clear path from prompt generation to review queue to prompt viewing

## Technical Requirements

### File Changes Required
- **`frontend/js/api.js`**: Add 4 new API methods with proper error handling
- **`frontend/js/workflow.js`**: Extend WorkflowManager with story-level state management
- **`frontend/projects/workflow.html`**: Add Stage 4 section with story cards interface
- **`frontend/css/styles.css`**: Basic styling for story cards and status indicators

### Architecture Constraints
- **Clean Integration**: Follow existing frontend patterns (no frameworks, vanilla JavaScript)
- **State Consistency**: Use existing localStorage patterns for state persistence
- **Error Handling**: Match existing error handling patterns from Stages 1-3
- **UI Patterns**: Maintain consistency with existing workflow stage interfaces

### Performance Considerations
- **Efficient Rendering**: Load approved stories once and cache in WorkflowManager state
- **Polling Strategy**: Check prompt approval status without overwhelming the backend
- **Memory Management**: Proper cleanup of event listeners and DOM elements

## Definition of Done
- [ ] Users can view approved stories as individual cards
- [ ] Each story has an independent "Generate Prompt" button
- [ ] Prompt generation creates review items in the existing review queue
- [ ] Status tracking persists across browser sessions
- [ ] Generated prompts are viewable when approved
- [ ] Error handling provides meaningful feedback for failures
- [ ] Integration tests pass for prompt generation API endpoints
- [ ] UI remains responsive with 14+ story cards displayed
- [ ] All existing functionality continues to work without regression

## Out of Scope (Future US-011B)
- Batch operations (generate all prompts at once)
- Advanced prompt viewing modal with download functionality
- Enhanced styling and visual polish
- Prompt customization preferences interface
- Progress indicators during generation